script: |
  # Undo -e since we expect all subsequent commands to fail.
  set +e
  chmod +x errorproc.sh && mkdir wd && mv errorproc.sh wd
  cat alerts.pcap | brimcap analyze -config=config1.yaml -
  >&2 echo === 
  brimcap analyze -config=config2.yaml alerts.pcap

inputs:
  - name: alerts.pcap
  - name: config1.yaml
    data: |
      analyzers:
        - cmd: ./errorproc.sh
          globs: ["*.zson"] # so ztail will not try to read errorproc.sh
          workdir: wd
  - name: config2.yaml
    data: |
      analyzers:
        - cmd: ./errorproc.sh
          globs: ["*.zson"] # so ztail will not try to read errorproc.sh
          stderr: stderr.out
          workdir: wd
  - name: errorproc.sh
    data: |
      #!/bin/bash
      >&2 echo "some error information in stderr"
      exit 1

outputs:
  - name: stderr
    data: |
      {"type":"error","error":"errorproc.sh exited with code 1\nstdout: (no output)\nstderr:\nsome error information in stderr\n"}
      ===
      {"type":"error","error":"errorproc.sh exited with code 1\nstdout: (no output)\nstderr:\nsome error information in stderr\n"}
  - name: stderr.out 
    data: |
      some error information in stderr
